# 分布式数据库
分布式数据库需要注意的几点。
1. 优化和sql执行计划
2. 并发控制
3. 日志和恢复

## 系统架构
1. shared everything
  - 实际上就是没分布，单机上运行多个数据库软件类似
2. shared mem
  - 多个cpu共享内存和硬盘
3. shared disk
  - 多个节点有独立的cpu和内存，共享硬盘
4. shared nothing
  - 无共享，多个节点直接通过网络相连
  - 效率高，但是扩展费劲，且很难保证一致性


## 节点
节点分为homo的和heter的，homo的节点就是每个节点都可以执行一样的任务。heter的则是节点之间有分工，有的是主节点有的是从节点。


## 数据分割
最简单的方法，一个节点一张表。

垂直分割：按列分割，一个节点存放部分列。

水平分割：一个节点存放部分行。
水平分割时可以依据数据范围，hash过后的范围，或者谓词来进行分割


逻辑划分，如果是多节点共享磁盘的方式，可以使用逻辑划分让各个节点负责部分数据的访问。

物理划分，数据分布在不同的节点上，不同节点负责不同数据。


一致性哈希：
在对分布式数据库进行扩容时，可以使用分布式hash,对hash结果的范围进行划分，不同节点负责存放不同范围的数据，当扩展新的节点时，让新的节点负责子范围，这样只需要进行部分数据的传输。


## 事务协调
集中式的现在用的很少了。
分布式的。
分布式的并发控制会比单机的多一些问题。
1. 数据备份如何控制
2. 网络通信的开销
3. 节点错误
4. 节点的时钟错误

如果在分布式数据库中使用2pl来进行并发控制，发生死锁时很难解决，因为通过网络同步维护依赖图不现实。
