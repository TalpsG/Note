# 查询优化
对于给定查询，找到正确的执行结果是有最低开销的。

## 逻辑和物理执行计划
优化器会生成一个逻辑表达式到等价的物理代数表达式的映射

物理算子定义了一个特定执行策略使用的访问路径

执行的流程如下
1. sql
2. parser
3. binder 将sql中的表和列的名字映射到具体的数据库中
4. tree rewriter
5. optimizer


## 查询优化方式
1. 启发式/规则式
按照一定的规则去重写或者去掉低效的部分，需要程序员总结经验，编写规则，不需要查询真实的数据。
2. 基于代价优化
使用模型去评估执行计划的代价，枚举多个等价的执行计划去寻找开销最小的。


## 逻辑查询优化
### 启发式
将逻辑计划通过模式匹配的方式转换为等价的逻辑计划。

1. 分裂连表谓语
  - 实际上就是把where里的多个条件拆分出来到多个and 
2. 谓词下移
  - 将查询条件下移到最低的位置
3. 将笛卡尔积替换为内连接`inner join`
4. 将投影操作也向下移动到最低的位置
  - 可以减少无关的信息

嵌套子查询的优化方式
1. 将两个查询改成一个查询
2. 将查询拆分出来，先做子查询，并且将结果存储起来，这样后面就不用每次都做子查询了


表达式重写
按照一定的规则将表达式重写一遍
### 基于代价
动态规划式的进行优化
