# lec8

b+树索引
数据库中常常使用索引来加快查找速度，由于b+树特殊的性质，常常使用b+树来构建索引。

索引就是表中部分属性的副本。


## 节点
b+树的节点中存在一组`kv`,`key`是表中的属性值。
对于叶子节点来说`v`可以是`rowid`或者整个`tuple`，对于非叶子则是一个指针，只想下一层的节点。

这里有两种存储值的方式
1. 存储对应记录的位置，比如`rowid`等内部记录用的编号或指针。
2. 存储整个`tuple`

## 重复key
1. 将记录id和key一起当作key.
2. 允许叶子节点有一个`overflow`节点用来存放重复的key


## 聚簇索引
调整数据存放的顺序，使其和索引的顺序一样。
常用于主键上，对主键使用聚簇索引，这样主键顺序和数据存放在磁盘上的数据一样。


## 合并阈值
有时推迟合并会是一件好事，比如删除元素后紧跟着插入，此时可能会导致刚合并的节点又要分裂。

## 变长key
1. 指针
2. 变长节点，少见
3. 填充，实际上就是让每个key占用很大的足够存放key的空间。
4. 类似`slot array`

## 内部节点的搜索
1. 线性查找
2. 二分
3. 推测


## 优化
1. 前缀压缩:对于叶子节点中，有相同前缀的`key`可以记录一个共同的前缀和每个key不同的部分。对于内部节点则只记录不同的部分即可
2. `pointer swizzling`:当非叶子节点内部的指针指向叶子节点(即数据页面)在`buffer pool`时，可以直接让指针指向内存中的元素。
3. `bulk insert`:对插入的元素进行排序，然后插入，速度会快很多。