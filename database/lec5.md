# lec5

## database workload
1. `on-line transaction processing`:每次只读取和更新小部分数据,操作很快
2. `olap`: 复杂的查询
3. 混合


## 物理存储模型
1. `N-ary storage model`
  - 对`oltp`很好，因为操作(`select *`)通常伴随着访问某条数据
  - 对于复杂查询，常常会读取许多不需要的数据
  - 对于扫描大量数据或小部分属性的操作不太友好
  - 内存局部性不好(因为常常查询只访问部分属性)
  - 不容易压缩，因为是`tuple-oriented`
2. `decoposition storage model`
  - 一个页面只存储一个属性值,列存储
  - `olap`友好 
  - 好压缩
  - 如何判断值属于哪一行？
    1. 固定长度值可以使用偏移来计算行号
    2. 同时存储值和行号(legacy)
  - 对于插入更新删除来说是比较慢的
如何将变长数据变为定长？
## 数据压缩
1. 压缩结果定长
2. 尽量推迟解压
3. 无损


四种压缩方式
1. 块压缩:压缩几条`tuple`
2. `tuple`压缩
3. 压缩`tuple`中的较大的属性值
4. 压缩列中的部分值(通常是常出现的)

对数据库进行查询时`dbms`会将目标值也压缩一边方便查询。
### run-length encoding
通常会对数据排序，然后单独列一个表，表中按顺序存放值以及值所在行号的范围.

### bit-packing encoding
对于属性值大小总是小于属性类型的情况，压缩其类型，存放时以较小类型存放。
此时属性中个别较大的值会单独存放在另一张表内。


### bitmap
当属性总是几个固定值时，可以使用`bitmap`，每一个可能的属性值一个`bitmap`，属性值对应的`map`中的1代表对应行号的属性值为该值。


### delta encoding
对数据进行增量的记录。
比如一张记录时间和气温的表。
时间的这一列每一行都递增1分钟，气温的变化也不大。此时可以对除第一行以外的所有行进行增量记录，记录属性与上一条属性的差。

### dictionary compression
构造一种数据结构，其中将属性值和固定长度的整数值映射到一起。

字典的常见实现:
1. 数组，缺点很多
2. 哈希表：压缩和解压快，但是无法进行范围查找
3. `B+`树，可以进行范围查找，速度比哈希表慢